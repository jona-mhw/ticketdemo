
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Backup para Supabase (Free Tier)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        code {
            background-color: #e8e8e8;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .warning, .info {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .warning {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .command-block {
            margin-bottom: 20px;
        }
        .command-block h3 {
            font-size: 1.1em;
            border-bottom: none;
            margin-bottom: 5px;
        }
        li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>Guía Completa: Backup y Restore en Supabase (Free Tier)</h1>
    <p>
        El plan gratuito de Supabase es fantástico para desarrollar, pero <strong>no incluye backups automáticos</strong>.
        Esto significa que es tu responsabilidad crear copias de seguridad periódicas. Esta guía te mostrará cómo hacerlo
        usando las herramientas estándar de PostgreSQL: <code>pg_dump</code> y <code>pg_restore</code>.
    </p>

    <h2>Paso 0: Prerrequisitos - Instalar Herramientas de PostgreSQL</h2>
    <p>
        Para empezar, necesitas tener <code>pg_dump</code> y <code>pg_restore</code> en tu computadora. La forma más fácil es
        instalando el cliente de PostgreSQL.
    </p>
    <ol>
        <li>Descarga el instalador desde el <a href="https://www.postgresql.org/download/" target="_blank">sitio web oficial de PostgreSQL</a>.</li>
        <li>Durante la instalación, asegúrate de seleccionar la opción "Command Line Tools".</li>
        <li>
            Para verificar que la instalación fue exitosa, abre una nueva terminal y ejecuta:
            <pre><code>pg_dump --version</code></pre>
            Deberías ver la versión de la herramienta, no un error de "comando no encontrado".
        </li>
    </ol>

    <h2>Parte 1: Crear el Backup con <code>pg_dump</code></h2>
    
    <h3>Paso 1.1: Obtener los Datos de Conexión</h3>
    <p>Necesitas las credenciales de tu base de datos para poder conectarte desde el exterior.</p>
    <ol>
        <li>Ve a tu <a href="https://app.supabase.com/" target="_blank">Dashboard de Supabase</a> y selecciona tu proyecto.</li>
        <li>En el menú lateral, ve a <strong>Project Settings</strong> (el ícono del engranaje).</li>
        <li>Selecciona la sección <strong>Database</strong>.</li>
        <li>Busca la sección <strong>Connection string</strong> y copia la URI. <strong>¡PERO LEE EL AVISO DE ABAJO!</strong></li>
    </ol>
    <div class="warning">
        <strong>¡ATENCIÓN! No uses la Connection String directamente.</strong><br>
        La URI que provee Supabase usa un "connection pooler" que puede dar problemas con <code>pg_dump</code>.
        En su lugar, usa los parámetros de conexión directa que se encuentran justo debajo en esa misma página.
    </div>

    <h3>Paso 1.2: Ejecutar el Comando de Backup</h3>
    <p>
        Abre tu terminal. Para manejar la contraseña de forma segura y evitar que quede en el historial de comandos,
        la asignaremos a una variable de entorno llamada <code>PGPASSWORD</code>.
    </p>

    <div class="command-block">
        <h3>Para Windows (CMD)</h3>
        <pre><code>set PGPASSWORD=eK86MYFIPB8c32t7
pg_dump -h "db.vwdujeylaytybxdwqnsz.supabase.co" -p 5432 -U postgres -d postgres -F c -b -v -f "backup.dump"
set PGPASSWORD=</code></pre>
    </div>

    <div class="command-block">
        <h3>Para macOS o Linux (Bash/Zsh)</h3>
        <pre><code>export PGPASSWORD='eK86MYFIPB8c32t7'
pg_dump --host "db.vwdujeylaytybxdwqnsz.supabase.co" --port 5432 --username postgres --dbname postgres --format=c --blobs --verbose --file="backup.dump"
unset PGPASSWORD</code></pre>
    </div>

    <div class="info">
        <h4>Desglose de los parámetros del comando:</h4>
        <ul>
            <li><code>-h / --host</code>: La dirección del servidor de tu base de datos.</li>
            <li><code>-p / --port</code>: El puerto de conexión (siempre 5432 para Supabase).</li>
            <li><code>-U / --username</code>: El usuario de la base de datos (siempre <code>postgres</code>).</li>
            <li><code>-d / --dbname</code>: El nombre de la base de datos (siempre <code>postgres</code>).</li>
            <li><code>-F c / --format=c</code>: Crea el backup en un formato comprimido. <strong>Es el recomendado</strong>.</li>
            <li><code>-b / --blobs</code>: Incluye los "large objects" en el backup. Importante.</li>
            <li><code>-v / --verbose</code>: Muestra mensajes de progreso detallados en la terminal.</li>
            <li><code>-f / --file</code>: El nombre del archivo de salida para tu backup.</li>
        </ul>
    </div>
    <p>
        Al ejecutar este comando, se creará el archivo <code>backup.dump</code> en la carpeta actual. ¡Guárdalo bien!
    </p>

    <h2>Parte 2: Restaurar el Backup con <code>pg_restore</code></h2>
    <p>
        Puedes restaurar este backup en una base de datos PostgreSQL local para desarrollar o en otro proyecto de Supabase.
    </p>
    <h3>Paso 2.1: Preparar la Base de Datos de Destino</h3>
    <p>
        Asegúrate de que tu servidor de PostgreSQL local esté funcionando. Luego, crea una base de datos <strong>vacía</strong>.
    </p>
    <pre><code>createdb nombre_de_tu_db_local</code></pre>

    <h3>Paso 2.2: Ejecutar el Comando de Restauración</h3>
    <pre><code>pg_restore --host localhost --port 5432 --username postgres --dbname nombre_de_tu_db_local --clean --no-owner "backup.dump"</code></pre>
    
    <div class="info">
        <h4>Desglose de los parámetros de restauración:</h4>
        <ul>
            <li><code>--dbname</code>: La base de datos <strong>vacía</strong> que acabas de crear.</li>
            <li><code>--clean</code>: <strong>Muy útil.</strong> Elimina los objetos de la base de datos antes de recrearlos. Asegura una restauración limpia.</li>
            <li><code>--no-owner</code>: No intenta asignar los dueños originales de los objetos. Evita errores de permisos.</li>
        </ul>
    </div>

    <h2>Consideraciones Finales</h2>
    <ul>
        <li><strong>Automatización:</strong> Puedes crear un script (<code>.bat</code> en Windows, <code>.sh</code> en macOS/Linux) con el comando de <code>pg_dump</code> y usar el <strong>Programador de Tareas de Windows</strong> o <strong>Cron (en macOS/Linux)</strong> para ejecutarlo automáticamente cada día o semana.</li>
        <li><strong>Supabase Storage:</strong> Este proceso <strong>NO RESPALDA</strong> los archivos que subes a Supabase Storage (imágenes, PDFs, etc.). Esos debes respaldarlos por separado.</li>
    </ul>

</body>
</html>
